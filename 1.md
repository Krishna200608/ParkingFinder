## ğŸ§­ **Parking Finder â€“ Project Summary (Full Context for New Chat)**

### ğŸš€ Overview

**Parking Finder** is a full-stack MERN application that helps drivers find and book parking spaces in real-time, while allowing hosts to list their own parking spots.
It focuses on solving urban parking issues by offering live availability, smart pricing, and seamless booking workflows.

---

### ğŸ—ï¸ **Project Architecture**

**Stack:**

* **Frontend:** React + Vite + Tailwind CSS + React Router + Leaflet (for maps)
* **Backend:** Express.js + Node.js + MongoDB (Mongoose ODM)
* **Auth:** JWT-based (supports both cookie & Bearer token)
* **Hosting compatibility:** Local & MongoDB Atlas

**Directory Structure:**

```
parking-finder/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ auth.controller.js
â”‚   â”‚   â”œâ”€â”€ bookings.controller.js
â”‚   â”‚   â””â”€â”€ spot.controller.js
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ authMiddleware.js
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ user.model.js
â”‚   â”‚   â”œâ”€â”€ booking.model.js
â”‚   â”‚   â””â”€â”€ parkingSpot.model.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ authRoutes.js
â”‚   â”‚   â”œâ”€â”€ bookingRoutes.js
â”‚   â”‚   â””â”€â”€ spotRoutes.js
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ generateToken.js
â”‚
â””â”€â”€ frontend/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ App.jsx
    â”‚   â”œâ”€â”€ context/AuthContext.jsx
    â”‚   â”œâ”€â”€ components/
    â”‚   â”‚   â”œâ”€â”€ Header.jsx
    â”‚   â”‚   â”œâ”€â”€ form/
    â”‚   â”‚   â”œâ”€â”€ host/
    â”‚   â”‚   â””â”€â”€ booking/
    â”‚   â”œâ”€â”€ pages/
    â”‚   â”‚   â”œâ”€â”€ HomePage.jsx
    â”‚   â”‚   â”œâ”€â”€ LoginPage.jsx
    â”‚   â”‚   â”œâ”€â”€ RegisterPage.jsx
    â”‚   â”‚   â”œâ”€â”€ MapPage.jsx
    â”‚   â”‚   â”œâ”€â”€ DashboardPage.jsx
    â”‚   â”‚   â”œâ”€â”€ HostDashboardPage.jsx
    â”‚   â”‚   â””â”€â”€ EditSpotPage.jsx
    â”‚   â””â”€â”€ index.css
```

---

### ğŸ” **Authentication**

* Users can **register**, **login**, and remain logged in via persisted JWT tokens.
* Auth middleware (`protect`) supports:

  * `Authorization: Bearer <token>` (frontend)
  * HTTP-only cookie (`jwt`) for backend-side persistence
* Context (`AuthContext.jsx`) maintains:

  * `userInfo`, `login(data)`, `logout()`, and `setAuthToken(token)` methods
* Navigation & route protection handled by `ProtectedRoute` & `HostRoute`.

---

### ğŸ—ºï¸ **Frontend Features**

* **Header Navigation:** Role-aware links (Driver â†’ Dashboard, Host â†’ Host Dashboard)
* **MapPage (React-Leaflet):**

  * Displays all available parking spots.
  * Uses `FlyToHelper` & `markerRefs` for smooth navigation.
  * â€œNavigateâ€ button smoothly flies to a marker and opens its popup.
  * â€œBookâ€ button opens a booking modal.
* **BookingModal:**

  * Shows map preview of the spot.
  * Separate date (`type="date"`) and time (`type="time"`) inputs.
  * Validates that end time > start time.
  * Calculates price dynamically using duration Ã— pricePerHour.
  * Sends POST `/api/bookings` payload:

    ```json
    {
      "spotId": "<spot_id>",
      "startTime": "<ISO start>",
      "endTime": "<ISO end>",
      "notes": ""
    }
    ```
  * Displays toast alerts for invalid input or slot conflicts.
* **DashboardPage (Driver):** Lists userâ€™s bookings with spot details and status.
* **HostDashboardPage:** Allows hosts to view, create, edit, and delete their spots.

---

### âš™ï¸ **Backend Logic**

#### ğŸ”¸ Auth

* `loginUser` returns `{ token, user }` JSON and sets cookie.
* `registerUser` auto-generates JWT and returns the same structure.

#### ğŸ”¸ Spots

* Routes:

  * `GET /api/spots/available` â†’ returns all available parking spots.
  * `GET /api/spots/my` â†’ lists spots owned by logged-in host.
  * `POST /api/spots` â†’ creates a new parking spot.
* Proper route order ensures `/available` executes before `/:id`.

#### ğŸ”¸ Bookings

* **`POST /api/bookings`**

  * Requires `spotId`, `startTime`, `endTime`.
  * Validates:

    * Spot exists and is available.
    * End time > Start time.
    * User authenticated.
  * Detects **overlaps** using:

    ```js
    $or: [{ startTime: { $lt: endTimeObj }, endTime: { $gt: startTimeObj } }]
    ```
  * Returns `409 Conflict` with message:

    ```
    Slot already booked from <start> to <end>. Please choose a different time.
    ```
  * Implements timestamp-based dynamic pricing (`hours * pricePerHour`).
  * Creates confirmed booking with `paymentStatus: "pending"`.
* **`GET /api/bookings/me`**

  * Returns all bookings for logged-in user (populated with `spot` & `host`).
* **(Planned)** `GET /api/bookings/spot/:spotId`

  * Will return existing booked intervals for that spot to pre-block unavailable slots in the modal.

---

### ğŸ’¡ **Recent Fixes**

* Fixed â€œCast to ObjectId failed for value 'available'â€ & `'me'` errors by reordering routes.
* Map â€œNavigateâ€ button now properly opens the popup.
* BookingModal now prevents booking invalid time ranges.
* Backend now gives precise conflict messages showing time ranges.
* Clean UX across mobile and desktop screens.

---

### ğŸ§© **Next Features to Implement**

1. `GET /api/bookings/spot/:spotId` â†’ Fetch booked time ranges.
2. Display booked time slots in modal before booking.
3. Optional: integrate Stripe or Razorpay for payments.
4. Optional: add role-based Admin panel for analytics and management.